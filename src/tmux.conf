# Enable mouse support
set -g mouse on

# Start numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Increase history limit
set -g history-limit 10000

# Better colors - enhanced for truecolor support
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"
set -ga terminal-overrides ",xterm-256color:Tc"
set -ga terminal-overrides ",screen-256color:Tc"
set -as terminal-overrides ',*:RGB'
set -as terminal-overrides ',*:sitm=\E[3m'

# Force color support
set -g @force_truecolor on

# Status bar customization - v3.0 (NO FLICKER - static format)
# Load modular status bar configuration
source-file ~/.vps/sessions/src/status-format-v3.tmux

# Easier window switching within session
bind-key -n M-1 select-window -t 1
bind-key -n M-2 select-window -t 2
bind-key -n M-3 select-window -t 3
bind-key -n M-4 select-window -t 4
bind-key -n M-5 select-window -t 5
bind-key -n M-6 select-window -t 6

# Active consoles (F1-F5) - created by default
bind-key -n C-F1 switch-client -t console-1
bind-key -n C-F2 switch-client -t console-2
bind-key -n C-F3 switch-client -t console-3
bind-key -n C-F4 switch-client -t console-4
bind-key -n C-F5 switch-client -t console-5

# Suspended consoles (F6-F10) - available on demand
# TODO: Add auto-create on first press or via F11 Manager
bind-key -n C-F6 switch-client -t console-6
bind-key -n C-F7 switch-client -t console-7
bind-key -n C-F8 switch-client -t console-8
bind-key -n C-F9 switch-client -t console-9
bind-key -n C-F10 switch-client -t console-10

# Manager Menu (F11) - Interactive TUI for terminal management
bind-key -n C-F11 run-shell "tmux has-session -t manager 2>/dev/null || tmux new-session -d -s manager -n 'Manager' '~/.vps/sessions/src/manager-menu.sh'; tmux switch-client -t manager"

# Help Reference (F12) - Static help text
bind-key -n C-F12 run-shell "tmux has-session -t help 2>/dev/null || tmux new-session -d -s help -n 'Help' '~/.vps/sessions/src/help-reference.sh'; tmux switch-client -t help"

# Quick navigation (Ctrl+Arrows)
bind-key -n C-Left switch-client -p          # Previous session
bind-key -n C-Right switch-client -n         # Next session

# Shortcuts popup (Ctrl+H for Help) - auto-detect tmux version
bind-key -n C-h run-shell "if tmux display-popup -h 1 'echo test' 2>/dev/null; then tmux display-popup -E -w 50 -h 12 '~/.vps/sessions/src/shortcuts-popup.sh'; else tmux split-window -v -l 12 '~/.vps/sessions/src/shortcuts-popup.sh; tmux kill-pane'; fi"

# Restart current console with confirmation (Ctrl+R) - auto-detect tmux version
bind-key -n C-r run-shell "if tmux display-popup -h 1 'echo test' 2>/dev/null; then tmux display-popup -E -w 70 -h 13 '~/.vps/sessions/src/restart-confirm.sh'; else tmux split-window -v -l 13 '~/.vps/sessions/src/restart-confirm.sh; tmux kill-pane'; fi"

# Reset session functionality
bind-key -n C-M-r send-keys 'clear && reset' Enter  # Ctrl+Alt+R: Reset current terminal

# Backup: Traditional session switching with Ctrl+b prefix (1-10)
bind-key 1 switch-client -t console-1
bind-key 2 switch-client -t console-2
bind-key 3 switch-client -t console-3
bind-key 4 switch-client -t console-4
bind-key 5 switch-client -t console-5
bind-key 6 switch-client -t console-6
bind-key 7 switch-client -t console-7
bind-key 8 switch-client -t console-8
bind-key 9 switch-client -t console-9
bind-key 0 switch-client -t console-10

# Visual session switcher
bind-key S choose-tree -s

# Quick jump to last session
bind-key L switch-client -l